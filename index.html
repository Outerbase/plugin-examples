<html>
<head>
    <title>Web Component Previewer</title>

    <!-- Sample Data Sets -->
    <script src="./sample-data/car-dealership.js"></script>

    <!-- Stylesheet -->
    <link rel="stylesheet" href="styles.css">

    <script src="index.js"></script>
</head>

<body>
    <div class="container">
        <div class="top-container">
            <div>
                <button onclick="refreshPage(0); selectViewTabIndex(0)">Cell</button>
                <button onclick="refreshPage(1); selectViewTabIndex(1)">Table</button>
                <button onclick="refreshPage(2); selectViewTabIndex(2)">Configuration</button>
            </div>

            <div>
                <button id="lightThemeButton">Light Mode</button>
                <button id="darkThemeButton">Dark Mode</button>
            </div>

            <!-- Cell Switchboard -->
            <div class="cell-switchboard" style="display: none; align-items: center; margin-top: 18px; display: grid; grid-template-columns: repeat(4, minmax(0, 1fr)); gap: 12px;">
                <div style="display: flex; align-items: center;">
                    <div id="cellUpdateCellPageIndicator" style="margin-right: 12px; width: 8px; height: 8px; border-radius: 4px; background-color: red;"></div>
                    <p style="margin: 0;">updateCell</p>
                </div>

                <div style="display: flex; align-items: center;">
                    <div id="cellOnEditPageIndicator" style="margin-right: 12px; width: 8px; height: 8px; border-radius: 4px; background-color: red;"></div>
                    <p style="margin: 0;">onEdit</p>
                </div>

                <div style="display: flex; align-items: center;">
                    <div id="cellOnStopEditPageIndicator" style="margin-right: 12px; width: 8px; height: 8px; border-radius: 4px; background-color: red;"></div>
                    <p style="margin: 0;">onStopEdit</p>
                </div>

                <div style="display: flex; align-items: center;">
                    <div id="cellOnCancelEditPageIndicator" style="margin-right: 12px; width: 8px; height: 8px; border-radius: 4px; background-color: red;"></div>
                    <p style="margin: 0;">onCancelEdit</p>
                </div>
            </div>
    
            <!-- Table Switchboard -->
            <div class="table-switchboard" style="display: none; align-items: center; margin-top: 18px; display: grid; grid-template-columns: repeat(4, minmax(0, 1fr)); gap: 12px;">
                <div style="display: flex; align-items: center;">
                    <div id="createRowPageIndicator" style="margin-right: 12px; width: 8px; height: 8px; border-radius: 4px; background-color: red;"></div>
                    <p style="margin: 0;">createRow</p>
                </div>

                <div style="display: flex; align-items: center;">
                    <div id="updateRowPageIndicator" style="margin-right: 12px; width: 8px; height: 8px; border-radius: 4px; background-color: red;"></div>
                    <p style="margin: 0;">updateRow</p>
                </div>

                <div style="display: flex; align-items: center;">
                    <div id="deleteRowPageIndicator" style="margin-right: 12px; width: 8px; height: 8px; border-radius: 4px; background-color: red;"></div>
                    <p style="margin: 0;">deleteRow</p>
                </div>

                <div style="display: flex; align-items: center;">
                    <div id="getPreviousPageIndicator" style="margin-right: 12px; width: 8px; height: 8px; border-radius: 4px; background-color: red;"></div>
                    <p style="margin: 0;">getPreviousPage</p>
                </div>

                <div style="display: flex; align-items: center;">
                    <div id="getNextPageIndicator" style="margin-right: 12px; width: 8px; height: 8px; border-radius: 4px; background-color: red;"></div>
                    <p style="margin: 0;">getNextPage</p>
                </div>
            </div>

            <!-- Configuration Switchboard -->
            <div class="configuration-switchboard" style="display: none; align-items: center; margin-top: 18px; display: grid; grid-template-columns: repeat(4, minmax(0, 1fr)); gap: 12px;">
                <div style="display: flex; align-items: center;">
                    <div id="configOnSavePageIndicator" style="margin-right: 12px; width: 8px; height: 8px; border-radius: 4px; background-color: red;"></div>
                    <p style="margin: 0;">onSave</p>
                </div>
            </div>
        </div>

        <div class="content-container">
            <div class="table_container">
                <outerbase-plugin-table
                    configuration=""
                    tableValue=""
                    metadata=""
                />
            </div>

            <div class="configuration_container">
                <outerbase-plugin-configuration 
                    tableValue=""
                    configuration=""
                />
            </div>

            <div class="column_container">
                <div style="width: 200px; height: 36px; border: 1px solid gray; overflow: hidden;">
                    <outerbase-plugin-cell></outerbase-plugin-cell>
                </div>
                
                <div style="width: 400px; height: auto; border: 1px solid gray; margin-top: 4px;">
                    <outerbase-plugin-cell-editor></outerbase-plugin-cell-editor>
                </div>
            </div>
        </div>
    </div>


    <script>
        function updateRows() {
            var tableElement = document.querySelector("outerbase-plugin-table");
            var configurationElement = document.querySelector("outerbase-plugin-configuration");

            const start = page * size;
            const end = start + size;
            let rowsCopy = carDealership.response.items.slice(start, end);
            let table = JSON.stringify(rowsCopy)?.replace(/"/g, '&quot;').replace(/'/g, '&#39;')
            
            if (tableElement) {
                tableElement.setAttribute("tableValue", table);
            }

            if (configurationElement) {
                configurationElement.setAttribute("tableValue", table);
            }
        }

        function toggleTheme(theme) {
            localStorage.setItem("selectedTheme", theme)
            var tableElement = document.querySelector("outerbase-plugin-table");
            var configurationElement = document.querySelector("outerbase-plugin-configuration");

            if (tableElement) {
                let options = {
                    theme: theme
                }
                let metadata = JSON.stringify(options)?.replace(/"/g, '&quot;').replace(/'/g, '&#39;')
                tableElement.setAttribute("metadata", metadata);
                configurationElement.setAttribute("metadata", metadata);
            }
        }

        document.addEventListener("DOMContentLoaded", function() {
            let savedViewIndex = localStorage.getItem("selectedViewIndex") ? localStorage.getItem("selectedViewIndex") : 0;
            selectViewTabIndex(savedViewIndex);

            let savedTheme = localStorage.getItem("selectedTheme") ? localStorage.getItem("selectedTheme") : "light";
            toggleTheme(savedTheme)

            var tableElement = document.querySelector("outerbase-plugin-table");
            var configurationElement = document.querySelector("outerbase-plugin-configuration");

            if (tableElement) {
                let config = JSON.stringify(carDealershipConfiguration)?.replace(/"/g, '&quot;').replace(/'/g, '&#39;')
                tableElement.setAttribute("configuration", config)
                configurationElement.setAttribute("configuration", config)
                configurationElement.setAttribute("configuration", config)
                
                updateRows()
            }
        });

        document.getElementById("lightThemeButton").addEventListener("click", function() {
            toggleTheme("light")
        })

        document.getElementById("darkThemeButton").addEventListener("click", function() {
            toggleTheme("dark")
        })
    </script>
</body>

</html>